let e=document.createElement("style");e.innerHTML=".flex[data-v-109fa019]{display:flex}.flex_column[data-v-109fa019]{display:flex;flex-direction:column}.flexIC[data-v-109fa019]{align-items:center}.flexAC[data-v-109fa019]{align-items:center;justify-content:center}.choseFileBtn[data-v-109fa019]{width:30%;margin:30px 0;border-radius:4px;background:#52d4d3}.choseFileBtn img[data-v-109fa019]{width:40px;height:40rpx}.allBox[data-v-109fa019]{width:30%;position:relative;background:#fff}.fileBox[data-v-109fa019]{margin:40px 20px 20px;min-height:400px;border:2px dashed #d1d1d1}.sendBtn[data-v-109fa019]{height:40px;width:400px;border-radius:20px;line-height:40px;text-align:center;color:#fff;margin:20px}.statusBox[data-v-109fa019]{position:absolute;top:10px;right:-100px}.SSClass[data-v-109fa019]{width:100px;height:30px;line-height:30px;text-align:center;background:#3fcfce;border-radius:0 15px 15px 0;color:#fff}.SSB[data-v-109fa019]{background:linear-gradient(#bddee1,#f0fcfd)}.SSC[data-v-109fa019]{background:#52d4d3}.SSCO[data-v-109fa019]{color:#52d4d3}.RSClass[data-v-109fa019]{width:60px;height:30px;line-height:30px;text-align:center;background:#555ab2;border-radius:0 15px 15px 0;color:#fff}.RSB[data-v-109fa019]{background:linear-gradient(#555ab2,#a690ff)}.RSC[data-v-109fa019]{background:#555ab2}.RSCO[data-v-109fa019]{color:#555ab2}.fileItemBox[data-v-109fa019]{margin:5px 10px;padding:10px 5px}.fileItemBox[data-v-109fa019] :hover{background:#e2f6ff}",document.head.appendChild(e);import{g as a,r as t,o as i,h as s,c as l,b as n,a as o,F as d,f as r,t as f,w as c,d as p,p as u,e as h}from"./index.16495088.js";import{s as g,e as x,p as v}from"./Peer.02a2d380.js";import{j as m,_ as y,a as S,b}from"./delect.46d59f8a.js";class C{constructor(e){this.file=e,this.reader=new FileReader,this.offset=0}getNextChunk(){return new Promise((e,a)=>{this.offset>=this.file.size&&e({done:!0}),this.reader.onload=a=>{const t=a.target.result;this.offset+=t.byteLength,e({done:this.offset>=this.file.size,chunk:t,offset:this.offset})},this.reader.onabort=()=>{a(new Error("FileReader abort"))},this.reader.onerror=e=>{a(new Error("FileReader onerror"+e))};const t=this.file.slice(this.offset,this.offset+65536);this.reader.readAsArrayBuffer(t)})}}var F={setup(){const e=s(),l=a(()=>e.params.rid),n=t(1),o=t(0),d=t([]),r=(t([]),t(!0)),f=(t(0),t([])),c=e=>{console.log("开始链接...."),v.connectPeer(e,!0)},p=e=>{v.signalingMessageCallback(e)},u=async(e,a)=>{await v.sendJson({type:e,payload:a})},h=()=>{let e=0;for(let a of d.value)e=a.size+e;o.value=e},y=async e=>{"string"==typeof e?(console.log("接收到文本消息：",e),await S(e)):(console.log("接收到流数据:",e),f.value.push(e))},S=async e=>{const a=JSON.parse(e);"DownloadFile"===a.type&&await(async e=>{const a=new C(d.value.find(a=>a.id==e));console.log("开始传输文件..."),await v.sendJson({type:"TransferFileStart",payload:{id:e}});let t=!1;for(;!t;){const e=await a.getNextChunk();t=e.done;const{chunk:i,offset:s}=e;try{await v.send(i)}catch(e){console.log("传输错误："+e);break}}console.log("传输文件完成..."),t&&await v.sendJson({type:"TransferFileEnd",payload:{id:e}})})(a.payload.id)};return i(async()=>{await g.start(),x.on("onJoinedRoom",c),x.on("onSignalingMessage",p),await(async e=>{try{await g.invoke("JoinRoom",e)}catch(e){console.error(e.toString())}})(l.value),m(".uploadFile").change((function(e){var a=m(".uploadFile").val();console.log(a,"上传的文件")})),v.on("onReceiveMessage",y)}),{roomId:l,sendFileList:d,isSendStatus:r,changeType:()=>{r.value=!r.value},choseFile:()=>{m(".uploadFile").click()},onDelFileItem:e=>{d.value=d.value.filter(a=>a.id!=e.id),u("DeleteFile",{id:e.id,status:e.status,name:e.name,size:e.size}),h()},onFileListChange:e=>{for(let e of event.target.files)e.id=n.value,e.status="ready",d.value.push(e),n.value++;u("AddFile",{id:e.target.files[0].id,status:e.target.files[0].status,name:e.target.files[0].name,size:e.target.files[0].size}),h()},uid:n,filsListSize:o}}};const w=c("data-v-109fa019");u("data-v-109fa019");const k={class:"allBox flex_column"},B={class:"statusBox flex_column"},R={class:"fileBox flex flexAC"},L={key:0,class:"flex_column flexAC"},_={key:1,class:"flex_column",style:{width:"100%"}},z={class:"fileItemBox"},I={class:"flex flexIC",style:{padding:"5px 0"}},O=o("img",{src:b,style:{width:"15px"}},null,-1),A={style:{"margin-left":"5px",color:"#1890ff"}},J={key:0,class:"fileRemark flex",style:{width:"100%"}};h();const T=w((function(e,a,t,i,s,c){return p(),l(d,null,[n(" 框 "),o("div",{class:["flex flexAC",[i.isSendStatus?"SSB":"RSB"]],style:{height:"100vh"}},[o("div",k,[n(" 状态控制器 "),o("div",B,[o("div",{class:"SSClass",onClick:a[1]||(a[1]=e=>i.changeType())},"发送端"),o("div",{class:"RSClass",onClick:a[2]||(a[2]=e=>i.changeType()),style:{"margin-top":"10px"}},"接收端")]),n(" 文件显示框 "),o("div",R,[0==i.sendFileList.length?(p(),l("div",L,[o("input",{type:"file",multiple:"",name:"uploadFile",id:"uploadFile",class:"uploadFile",style:{visibility:"hidden",position:"absolute",top:"0px",width:"0px"},onChange:a[3]||(a[3]=e=>i.onFileListChange(e))},null,32),n(" <div @click='choseFile' class=\"choseFileBtn\">上传文件</div> "),o("img",{src:y,onClick:a[4]||(a[4]=(...e)=>i.choseFile(...e)),style:{width:"40%"}}),o("span",{class:[i.isSendStatus?"SSCO":"RSCO"]},"点击上方按钮进行上传",2)])):(p(),l("div",_,[(p(!0),l(d,null,r(i.sendFileList,(e,a)=>(p(),l("div",z,[o("div",I,[O,o("text",A,f(e.name),1),o("img",{style:{"margin-left":"auto",width:"15px",height:"15px"},src:S,onClick:a=>i.onDelFileItem(e)},null,8,["onClick"])])]))),256))]))]),i.sendFileList.length>0?(p(),l("div",J,[n(" background: #555ab2 "),o("input",{type:"file",multiple:"",name:"uploadFile",id:"uploadFile",class:"uploadFile",style:{visibility:"hidden",position:"absolute",top:"0px",width:"0px"},onChange:a[5]||(a[5]=e=>i.onFileListChange(e))},null,32),o("div",{style:{"font-weight":"bold","margin-left":"20px"},class:[i.isSendStatus?"SSCO":"RSCO"],onClick:a[6]||(a[6]=(...e)=>i.choseFile(...e))},"添加文件",2),o("div",{style:{"margin-left":"auto","margin-right":"20px"},class:[i.isSendStatus?"SSCO":"RSCO"]},f(i.sendFileList.length)+"个文件,共"+f(i.filsListSize)+"b",3)])):n("v-if",!0)])],2)],64)}));F.render=T,F.__scopeId="data-v-109fa019",F.__file="src/views/Receive.vue";export default F;
