let e=document.createElement("style");e.innerHTML=".flex[data-v-109fa019]{display:flex}.flex_column[data-v-109fa019]{display:flex;flex-direction:column}.flexIC[data-v-109fa019]{align-items:center}.flexAC[data-v-109fa019]{align-items:center;justify-content:center}.choseFileBtn[data-v-109fa019]{width:30%;margin:30px 0;border-radius:4px;background:#52d4d3}.choseFileBtn img[data-v-109fa019]{width:40px;height:40rpx}.allBox[data-v-109fa019]{width:30%;position:relative;background:#fff}.fileBox[data-v-109fa019]{margin:40px 20px 20px;min-height:400px;border:2px dashed #d1d1d1}.sendBtn[data-v-109fa019]{height:40px;width:400px;border-radius:20px;line-height:40px;text-align:center;color:#fff;margin:20px}.statusBox[data-v-109fa019]{position:absolute;top:10px;right:-100px}.SSClass[data-v-109fa019]{width:60px;height:30px;line-height:30px;text-align:center;background:#3fcfce;border-radius:0 15px 15px 0;color:#fff}.SSB[data-v-109fa019]{background:linear-gradient(#bddee1,#f0fcfd)}.SSC[data-v-109fa019]{background:#52d4d3}.SSCO[data-v-109fa019]{color:#52d4d3}.RSClass[data-v-109fa019]{width:60px;height:30px;line-height:30px;text-align:center;background:#555ab2;border-radius:0 15px 15px 0;color:#fff}.active[data-v-109fa019]{width:100px!important}.RSB[data-v-109fa019]{background:linear-gradient(#555ab2,#a690ff)}.RSC[data-v-109fa019]{background:#555ab2}.RSCO[data-v-109fa019]{color:#555ab2}.fileItemBox[data-v-109fa019]{margin:5px 10px;padding:10px 5px}.fileItemBox[data-v-109fa019] :hover{background:#e2f6ff}",document.head.appendChild(e);import{f as a,r as t,o as i,i as l,g as s,c as n,b as o,a as d,t as c,F as r,w as f,d as p,p as u,e as v}from"./index.3bd6fbea.js";import{s as x,e as g,p as S}from"./Peer.36491284.js";import{s as h,a as y,b as F,T as m,r as w,F as b}from"./ReceiveFileList.050259af.js";var C={components:{EmptyFileList:h,SendFileList:y,ReceiveFileList:F},emits:["onSelectFiles","onRemoveFile","onDownloadFile"],setup(){const e=l(),s=a(()=>e.params.rid),n=t(1),o=t([]),d=t([]),c=t([]),r=t(!0),f=t(0),p=t([]),u=a(()=>{let e=0;for(let a of d.value)e=a.size+e;return w(e)}),v=a(()=>{let e=0;for(let a of p.value)e+=a.byteLength;return e}),h=async(e,a)=>{await S.sendJson({type:e,payload:a})},y=async e=>{const a=JSON.parse(e);if("TransferFileStart"===a.type){let e=c.value.find(e=>e.id==a.payload.id);f.value=a.payload.id,e.status="transfering"}else if("DownloadFile"==a.type)await(async e=>{let a=o.value.find(a=>a.id==e),t=d.value.find(a=>a.id==e);const i=new b(a);await S.sendJson({type:"TransferFileStart",payload:{id:e}}),t.status="transfering";let l=!1;for(;!l;){const e=await i.getNextChunk();l=e.done;const{chunk:a,offset:s}=e;try{await S.send(a),t.precent=(s/t.size*100).toFixed(2)}catch(e){console.log("传输错误："+e);break}}l&&(await S.sendJson({type:"TransferFileEnd",payload:{id:e}}),t.precent=100,t.status="success")})(a.payload.id);else if("TransferFileEnd"===a.type){let e=c.value.find(e=>e.id==a.payload.id);e.status="success",e.precent=100;const t=new Blob(p.value),i=document.createElement("a");i.href=window.URL.createObjectURL(t),i.download=e.name,i.click(),window.URL.revokeObjectURL(i.href)}else"AddFile"===a.type?c.value.push(a.payload):"DeleteFile"===a.type&&(c.value=c.value.filter(e=>e.id!=a.payload.id))},F=e=>{console.log("开始链接...."),S.connectPeer(e,!0)},C=e=>{S.signalingMessageCallback(e)},k=async e=>{if("string"==typeof e)await y(e);else{let a=c.value.find(e=>e.id==f.value);p.value.push(e),a.precent=(v.value/a.size*100).toFixed(2)}};return i(async()=>{await x.start(),g.on("onJoinedRoom",F),g.on("onSignalingMessage",C),await(async e=>{try{await x.invoke("JoinRoom",e)}catch(e){console.error(e.toString())}})(s.value),S.on("onReceiveMessage",k)}),{roomId:s,sendFileList:d,sendFileTotalSize:u,receiveFileList:c,isSendStatus:r,changeType:()=>{r.value=!r.value},onSelectFiles:async e=>{for(let a of e){a.id=n.value,a.precent=0,a.status="prepare",n.value++;const e=new m(a);o.value.push(a),d.value.push(e),await h("AddFile",e)}},onChoseFile:()=>{document.getElementById("uploadFile").click()},onRemoveFile:async e=>{for(let a in d.value)e==d.value[a].id&&(d.value.splice(a,1),o.value.splice(a,1),await h("DeleteFile",{id:e}))},onDownloadFile:async e=>{await S.sendJson({type:"DownloadFile",payload:{id:e}})}}}};const k=f("data-v-109fa019");u("data-v-109fa019");const R={class:"allBox flex_column"},L={class:"statusBox flex_column"},B={key:0,class:"fileBox flexAC"},O={key:0,class:"flex_column flexAC"},T={key:1,class:"flex_column"},_={key:1,class:"fileRemark flex",style:{width:"100%"}},D={key:2,class:"fileBox flexAC"},A={class:"flex_column"};v();const E=k((function(e,a,t,i,l,f){const u=s("EmptyFileList"),v=s("SendFileList"),x=s("ReceiveFileList");return p(),n(r,null,[o(" 框 "),d("div",{class:["flex flexAC",[i.isSendStatus?"SSB":"RSB"]],style:{height:"100vh"}},[d("div",R,[o(" 状态控制器 "),d("div",L,[d("div",{class:["SSClass",{active:i.isSendStatus}],onClick:a[1]||(a[1]=e=>i.changeType())},"发送端",2),d("div",{class:["RSClass",{active:!i.isSendStatus}],onClick:a[2]||(a[2]=e=>i.changeType()),style:{"margin-top":"10px"}},"接收端",2)]),o(" 文件显示框 "),i.isSendStatus?(p(),n("div",B,[0==i.sendFileList.length?(p(),n("div",O,[d(u,{onOnSelectFiles:i.onSelectFiles},null,8,["onOnSelectFiles"])])):(p(),n("div",T,[d(v,{files:i.sendFileList,onOnRemoveFile:i.onRemoveFile},null,8,["files","onOnRemoveFile"])]))])):o("v-if",!0),i.sendFileList.length>0&&i.isSendStatus?(p(),n("div",_,[o(" background: #555ab2 "),d("input",{type:"file",multiple:"",name:"uploadFile",id:"uploadFile",class:"uploadFile",style:{visibility:"hidden",position:"absolute",top:"0px",width:"0px"},onChange:a[3]||(a[3]=e=>i.onSelectFiles(e.target.files))},null,32),d("div",{style:{"font-weight":"bold","margin-left":"20px"},class:[i.isSendStatus?"SSCO":"RSCO"],onClick:a[4]||(a[4]=(...e)=>i.onChoseFile(...e))},"添加文件",2),d("div",{style:{"margin-left":"auto","margin-right":"20px"},class:[i.isSendStatus?"SSCO":"RSCO"]},c(i.sendFileList.length)+"个文件,共"+c(i.sendFileTotalSize),3)])):o("v-if",!0),i.isSendStatus?o("v-if",!0):(p(),n("div",D,[d("div",A,[d(x,{files:i.receiveFileList,onOnDownloadFile:i.onDownloadFile},null,8,["files","onOnDownloadFile"])])])),o(' <div style="width:100%" class="flex flexAC">\r\n        <div class="sendBtn" :class="[isSendStatus?\'SSC\':\'RSC\']">创建链接</div>\r\n      </div>')])],2)],64)}));C.render=E,C.__scopeId="data-v-109fa019",C.__file="src/views/Receive.vue";export default C;
