let e=document.createElement("style");e.innerHTML=".container[data-v-2c3b027c]{height:100vh;display:flex;justify-content:center;align-items:center}.send[data-v-2c3b027c]{background-color:#9896f1}.receive[data-v-2c3b027c]{background-color:#d59bf6}.card[data-v-2c3b027c]{width:380px;box-shadow:0 2px 1px -1px rgba(0,0,0,.2),0 1px 1px 0 rgba(0,0,0,.14),0 1px 3px 0 rgba(0,0,0,.12);transition:box-shadow 280ms cubic-bezier(.4,0,.2,1);border-radius:4px;margin:0 auto;padding:16px;background:#fff}.card-header[data-v-2c3b027c]{position:relative}.card-title[data-v-2c3b027c]{text-align:center;font-weight:700;color:#111}.card-action__switch[data-v-2c3b027c]{position:absolute;top:0;right:0;cursor:pointer;color:#667d99}.card-action__add[data-v-2c3b027c]{cursor:pointer;color:#667d99}.card-content[data-v-2c3b027c]{min-height:275px;margin:16px 0;border:2px dashed #d1d1d1}.card-footer[data-v-2c3b027c]{display:flex;justify-content:space-between}.card-text[data-v-2c3b027c]{font-size:14px;color:#c9d6df}",document.head.appendChild(e);import{r as a,h as i,b as t,u as l,d as n,c as s,e as d,t as o,a as c,f as r,o as p,p as u,g as v}from"./index.98f7c87a.js";import{p as f}from"./Peer.7b017b62.js";import{s as F,a as y,b,T as h,F as w,r as g}from"./ReceiveFileList.cedc6ad8.js";var m={components:{EmptyFileList:F,SendFileList:y,ReceiveFileList:b},emits:["onSelectFiles","onRemoveFile","onDownloadFile"],setup(){l();const e=a(1),n=a([]),s=a([]),d=a([]),o=a(!0),c=a(0),r=a([]),p=i(()=>o.value?"发送文件":"接收文件"),u=i(()=>{let e=0;for(let a of s.value)e=a.size+e;return g(e)}),v=i(()=>{let e=0;for(let a of r.value)e+=a.byteLength;return e}),F=async(e,a)=>{await f.sendJson({type:e,payload:a})},y=e=>{if("string"==typeof e)b(e);else{let a=d.value.find(e=>e.id==c.value);r.value.push(e),a.precent=(v.value/a.size*100).toFixed(2)}},b=async e=>{const a=JSON.parse(e);if("TransferFileStart"===a.type){let e=d.value.find(e=>e.id==a.payload.id);c.value=a.payload.id,e.status="transfering"}else if("DownloadFile"==a.type)await(async e=>{let a=n.value.find(a=>a.id==e),i=s.value.find(a=>a.id==e);const t=new w(a);await f.sendJson({type:"TransferFileStart",payload:{id:e}}),i.status="transfering";let l=!1;for(;!l;){const e=await t.getNextChunk();l=e.done;const{chunk:a,offset:n}=e;try{i.precent=(n/i.size*100).toFixed(2),await f.send(a)}catch(e){console.log("传输错误："+e);break}}l&&(await f.sendJson({type:"TransferFileEnd",payload:{id:e}}),i.precent=100,i.status="success")})(a.payload.id);else if("TransferFileEnd"===a.type){let e=d.value.find(e=>e.id==a.payload.id);e.status="success",e.precent=100;const i=new Blob(r.value),t=document.createElement("a");t.href=window.URL.createObjectURL(i),t.download=e.name,t.click(),window.URL.revokeObjectURL(t.href)}else"AddFile"===a.type?d.value.push(a.payload):"DeleteFile"===a.type&&(d.value=d.value.filter(e=>e.id!=a.payload.id))};return t(async()=>{f.on("onReceiveMessage",y)}),{title:p,sendFileList:s,sendFileTotalSize:u,receiveFileList:d,isSendFile:o,changeType:()=>{o.value=!o.value},onSelectFiles:async a=>{for(let i of a){i.id=e.value,i.precent=0,i.status="prepare";const a=new h(i);n.value.push(i),s.value.push(a),await F("AddFile",a),e.value++}},onChoseFile:()=>{document.getElementById("uploadFile").click()},onRemoveFile:async e=>{for(let a in s.value)if(e==s.value[a].id)return s.value.splice(a,1),n.value.splice(a,1),void await F("DeleteFile",{id:e})},onDownloadFile:async e=>{await f.sendJson({type:"DownloadFile",payload:{id:e}})},uid:e}}};const x=r("data-v-2c3b027c");u("data-v-2c3b027c");const L={class:"card"},S={class:"card-header"},k={class:"card-title"},R={key:0,class:"card-content"},_={key:1,class:"card-content"},T={key:2,class:"card-footer"},D={class:"card-text"};v();const O=x((function(e,a,i,t,l,r){const u=n("EmptyFileList"),v=n("SendFileList"),f=n("ReceiveFileList");return p(),s("div",{class:["container",{send:t.isSendFile,receive:!t.isSendFile}]},[d("div",L,[d("div",S,[d("div",k,o(t.title),1),d("div",{class:"card-action__switch",onClick:a[1]||(a[1]=e=>t.changeType())},"切换")]),t.isSendFile?(p(),s("div",R,[0==t.sendFileList.length?(p(),s(u,{key:0,onOnSelectFiles:t.onSelectFiles},null,8,["onOnSelectFiles"])):(p(),s(v,{key:1,files:t.sendFileList,onOnRemoveFile:t.onRemoveFile},null,8,["files","onOnRemoveFile"]))])):(p(),s("div",_,[d(f,{files:t.receiveFileList,onOnDownloadFile:t.onDownloadFile},null,8,["files","onOnDownloadFile"])])),t.sendFileList.length>0&&t.isSendFile?(p(),s("div",T,[d("input",{type:"file",multiple:"",name:"uploadFile",id:"uploadFile",class:"uploadFile",style:{visibility:"hidden",position:"absolute",top:"0px",width:"0px"},onChange:a[2]||(a[2]=e=>t.onSelectFiles(e.target.files))},null,32),d("div",{class:"card-action__add",onClick:a[3]||(a[3]=(...e)=>t.onChoseFile(...e))},"添加文件"),d("div",D,o(t.sendFileList.length)+" 个文件,共 "+o(t.sendFileTotalSize),1)])):c("v-if",!0)])],2)}));m.render=O,m.__scopeId="data-v-2c3b027c",m.__file="src/views/Send.vue";export default m;
